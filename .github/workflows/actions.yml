name: MCP TypeScript OAuth Translation
on:
  push:
    branches: [main, ft-lp-test, ft-claude-demo]
    paths: 
      - 'languages/en-US/**'
  pull_request:
    branches: [main, ft-lp-test, ft-claude-demo]
    paths:
      - 'languages/en-US/**'

permissions:
  contents: write
  actions: read

jobs:
  mcp-typescript-translation:
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.LOCALIZATION_MCP_TOKEN }}
          fetch-depth: 0
      
      - name: 🟢 Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22.12.0'
      
      - name: 📦 Install dependencies
        run: |
          npm install
          npm install -g tsx
      
      - name: 🔧 Build MCP TypeScript (opcional)
        run: |
          if [ -f "src/translateflow-tool/main.ts" ]; then
            echo "🏗️ Compiling MCP TypeScript..."
            npx tsc src/translateflow-tool/main.ts --outDir dist --target es2022 --module esnext || echo "⚠️ Compilation failed"
          fi

      - name: 🔐 Run MCP TypeScript OAuth
        run: node scripts/process-translation-claude.js
        env:
          CLAUDE_CODE_OAUTH_TOKEN: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}

      - name: 💾 Commit results
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "MCP TypeScript Bot"
          git add languages/
          git diff --staged --quiet || git commit -m "🔧 MCP TypeScript OAuth translations"
          git push